<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Race Winner Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', sans-serif;
            background: #000;
            background-image: 
                linear-gradient(45deg, #111 25%, transparent 25%),
                linear-gradient(-45deg, #111 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #111 75%),
                linear-gradient(-45deg, transparent 75%, #111 75%);
            background-size: 40px 40px;
            background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
            overflow-x: hidden;
        }
        .neon-text {
            text-shadow: 0 0 5px #e10600, 0 0 10px #e10600, 0 0 20px #ff1900, 0 0 40px #ff1900;
        }
        .neon-box {
            border: 2px solid rgba(225, 6, 0, 0.6);
            box-shadow: 0 0 15px rgba(225, 6, 0, 0.8), inset 0 0 10px rgba(225, 6, 0, 0.3);
        }
        .glow-button {
            background: linear-gradient(90deg, #e10600, #ff3300);
            box-shadow: 0 0 20px rgba(225, 6, 0, 0.8);
            transition: all 0.3s ease;
        }
        .glow-button:hover:not(:disabled) {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 0 30px rgba(255, 50, 0, 1);
        }
        .scanlines {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                to bottom,
                rgba(255,255,255,0.02) 0px,
                rgba(255,255,255,0.02) 2px,
                transparent 2px,
                transparent 4px
            );
            animation: flicker 1s infinite;
        }
        @keyframes flicker {
            0%, 19.999%, 22%, 62.999%, 64%, 100% { opacity: 0.99; }
            20%, 21.999%, 63%, 63.999% { opacity: 0.4; }
        }
        .result-card {
            transition: transform 0.8s ease;
            transform-style: preserve-3d;
        }
        .result-card.flipped {
            transform: rotateY(180deg);
        }
        .result-face {
            backface-visibility: hidden;
        }
        .result-back {
            transform: rotateY(180deg);
        }
    </style>
</head>
<body class="text-white relative min-h-screen flex items-center justify-center p-6">
    <div class="scanlines"></div>

    <div class="w-full max-w-lg neon-box rounded-xl p-6 relative z-10 bg-black/70">
        <header class="text-center mb-6">
            <h1 class="text-4xl font-extrabold neon-text mb-2">üèéÔ∏è F1 Predictor üèÅ</h1>
            <p class="text-gray-400">Select a Grand Prix and unleash the forecast.</p>
        </header>

        <main>
            <div class="space-y-4">
                <div>
                    <label for="track-select" class="block text-sm font-bold text-red-400 mb-1">GRAND PRIX</label>
                    <select id="track-select" class="w-full bg-black text-white border border-red-600 rounded-md p-3 focus:ring-2 focus:ring-red-500 outline-none">
                        <option>Loading tracks...</option>
                    </select>
                </div>

                <button id="predict-btn" class="w-full glow-button font-bold text-lg py-3 rounded-md disabled:opacity-50 disabled:cursor-not-allowed">
                    üö¶ Predict Winner
                </button>
            </div>

            <!-- Result Display -->
            <div id="result-container" class="mt-6 hidden">
                <div id="result-card" class="result-card relative w-full h-48">
                    <!-- Front -->
                    <div class="result-face absolute inset-0 flex flex-col items-center justify-center bg-black/80 neon-box rounded-lg">
                        <p class="text-gray-400">The prediction will appear here.</p>
                    </div>
                    <!-- Back -->
                    <div class="result-face result-back absolute inset-0 flex flex-col items-center justify-center bg-black/80 neon-box rounded-lg text-center px-4">
                        <p class="text-sm text-gray-400 mb-1">üèÜ Predicted Champion üèÜ</p>
                        <p id="winner-name" class="text-3xl font-extrabold neon-text"></p>
                        <p id="analysis-text" class="text-gray-300 text-sm mt-3 italic"></p>
                    </div>
                </div>
            </div>

            <p id="status-text" class="text-center text-xs text-gray-500 mt-4">Status: Ready.</p>
        </main>
    </div>

    <script>
        const trackSelect = document.getElementById('track-select');
        const predictBtn = document.getElementById('predict-btn');
        const resultContainer = document.getElementById('result-container');
        const resultCard = document.getElementById('result-card');
        const winnerName = document.getElementById('winner-name');
        const analysisText = document.getElementById('analysis-text');
        const statusText = document.getElementById('status-text');

        const API_BASE_URL = 'https://f1-predictor-app.onrender.com';

        async function loadTracks() {
            statusText.textContent = 'Status: Loading race data...';
            try {
                const response = await fetch(`${API_BASE_URL}/api/racedata`);
                if (!response.ok) throw new Error('Failed to fetch race data.');
                const raceData = await response.json();
                const trackNames = [...new Set(raceData.map(race => race.raceName))].sort();

                trackSelect.innerHTML = '<option value="">-- Select a Grand Prix --</option>';
                trackNames.forEach(track => {
                    const option = document.createElement('option');
                    option.value = track;
                    option.textContent = track;
                    trackSelect.appendChild(option);
                });
                statusText.textContent = 'Status: Ready.';
            } catch (error) {
                statusText.textContent = `Status: Error! ${error.message}`;
                trackSelect.innerHTML = '<option>Could not load tracks</option>';
            }
        }

        async function handlePrediction() {
            const selectedTrack = trackSelect.value;
            if (!selectedTrack) return;

            statusText.textContent = 'Status: Calculating prediction...';
            predictBtn.disabled = true;
            resultContainer.classList.remove('hidden');

            if (resultCard.classList.contains('flipped')) {
                resultCard.classList.remove('flipped');
                await new Promise(r => setTimeout(r, 400));
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ track: selectedTrack }),
                });

                if (!response.ok) throw new Error('Prediction failed.');
                const result = await response.json();

                winnerName.textContent = result.winner;
                analysisText.textContent = `All indicators point to ${result.winner} dominating this Grand Prix. The data strongly supports this outcome.`;

                setTimeout(() => {
                    resultCard.classList.add('flipped');
                    statusText.textContent = 'Status: Prediction complete.';
                }, 100);

            } catch (error) {
                winnerName.textContent = 'Error';
                analysisText.textContent = 'Could not retrieve prediction.';
                setTimeout(() => resultCard.classList.add('flipped'), 100);
                statusText.textContent = `Status: Error! ${error.message}`;
            } finally {
                predictBtn.disabled = false;
            }
        }

        predictBtn.addEventListener('click', handlePrediction);
        document.addEventListener('DOMContentLoaded', loadTracks);
    </script>
</body>
</html>
